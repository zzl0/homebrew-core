class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-02-08",
      revision: "be22559ab8015002386a08082511a99f5750b056"
  version "2023-02-08"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "dd7029cc0b1cb2d388119a18b41c4ab3afe29c612ba4fd22169bce11c0fb367d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "100d86f3d7c2d13f985213acd15f110971e85c539d5cc921675f00006efa063e"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "ecb8229d49e8659878623419436993b22248a1dd403f120d75f43cb8ddb85c00"
    sha256 cellar: :any_skip_relocation, ventura:        "db3e97bc7f405da6ef5ee1725eb13e806639b7cc733974fdf9ce28ae3a1ecb76"
    sha256 cellar: :any_skip_relocation, monterey:       "ea608867ef8ad2832f503c967abf955ee876284333590bb577f782153bf78856"
    sha256 cellar: :any_skip_relocation, big_sur:        "352a6dabae2b02e1118ff05c331e28ae197afe065a7afc9cbf99726339756f84"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "30ee12d4e16478556a38b65bae31b5efe00e1230e23ea4951a4b997417fd7016"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
