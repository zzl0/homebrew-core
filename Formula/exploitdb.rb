class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-02-21",
      revision: "e194129791561bd4d95100d0307bcdc5dc9a04b2"
  version "2023-02-21"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "ddab69e55dd3bfbea7b7a6b75f91611f5b36952c0d7c60a4977f52fa8af639e5"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "951eb8e169e1e30388378fd563330dfafb33d58a230f20d800fdf5b8f150a301"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "6e7d3326e36bbcbbb44cce0e8c5285c5c10043197d267b149d08280968e4570b"
    sha256 cellar: :any_skip_relocation, ventura:        "39181c7442adb235337a53a5a6df0e638b01ce200e027e6ee42eca8d90d44e33"
    sha256 cellar: :any_skip_relocation, monterey:       "1d2c0612a3c7f9cb2c6a8ed06f732318d2c1e55a8da288b11b21f28bd5f36381"
    sha256 cellar: :any_skip_relocation, big_sur:        "af8dd72458a94af504a7b4f151c224a27ce3af0fed8013c3b1d164d3108660a0"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "cafa644cbf142b61a804a4e0b30ca9e0f7204dbce2a5a9eeb6f00c6b89a28ba1"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
